var ZYFILE={fileInput:null,uploadInput:null,dragDrop:null,url:"",uploadFile:[],lastUploadFile:[],perUploadFile:[],fileNum:0,filterFile:function(t){return t},onSelect:function(t,e){},onDelete:function(t,e){},onProgress:function(t,e,i){},onSuccess:function(t,e){},onFailure:function(t,e){},onComplete:function(t){},funDragHover:function(t){return t.stopPropagation(),t.preventDefault(),this["dragover"===t.type?"onDragOver":"onDragLeave"].call(t.target),this},funGetFiles:function(t){var e=this;this.funDragHover(t);var i=t.target.files||t.dataTransfer.files;e.lastUploadFile=this.uploadFile,this.uploadFile=this.uploadFile.concat(this.filterFile(i));var n=[],a=[],r=[];return $.each(e.lastUploadFile,function(t,e){a.push(e.name)}),$.each(e.uploadFile,function(t,e){r.push(e.name)}),$.each(r,function(t,i){$.inArray(i,a)<0&&n.push(e.uploadFile[t])}),this.uploadFile=n,this.funDealtFiles(),!0},funDealtFiles:function(){var t=this;$.each(this.uploadFile,function(e,i){i.index=t.fileNum,t.fileNum++});var e=this.uploadFile;return this.perUploadFile=this.perUploadFile.concat(this.uploadFile),this.uploadFile=this.lastUploadFile.concat(this.uploadFile),this.onSelect(e,this.uploadFile),console.info("继续选择"),console.info(this.uploadFile),this},funDeleteFile:function(t,e){var i=this,n=[],a=this.perUploadFile[t];return console.info(a),$.each(this.uploadFile,function(t,e){a!=e&&n.push(e)}),this.uploadFile=n,e&&i.onDelete(a,this.uploadFile),console.info("还剩这些文件没有上传:"),console.info(this.uploadFile),!0},funUploadFiles:function(){var t=this;$.each(this.uploadFile,function(e,i){t.funUploadFile(i)})},funUploadFile:function(t){var e=this,i=new FormData;i.append("fileList",t);var n=new XMLHttpRequest;n.upload.addEventListener("progress",function(i){e.onProgress(t,i.loaded,i.total)},!1),n.addEventListener("load",function(i){e.funDeleteFile(t.index,!1),e.onSuccess(t,n.responseText),0==e.uploadFile.length&&e.onComplete("全部完成")},!1),n.addEventListener("error",function(i){e.onFailure(t,n.responseText)},!1),n.open("POST",e.url,!0),n.setRequestHeader("X_FILENAME",t.name),n.send(i)},funReturnNeedFiles:function(){return this.uploadFile},init:function(){var t=this;this.dragDrop&&(this.dragDrop.addEventListener("dragover",function(e){t.funDragHover(e)},!1),this.dragDrop.addEventListener("dragleave",function(e){t.funDragHover(e)},!1),this.dragDrop.addEventListener("drop",function(e){t.funGetFiles(e)},!1)),t.fileInput&&this.fileInput.addEventListener("change",function(e){t.funGetFiles(e)},!1),t.uploadInput&&this.uploadInput.addEventListener("click",function(e){t.funUploadFiles(e)},!1)}};