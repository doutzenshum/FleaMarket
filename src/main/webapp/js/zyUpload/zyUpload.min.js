!function(t,e){t.fn.zyUpload=function(e,i){var n=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var a=this[0][e];if(t.isFunction(a))return a.apply(this,n);throw"zyUpload - No such method: "+e}return this.each(function(){var i={},n=this,a={width:"520px",height:"300px",itemWidth:"140px",itemHeight:"120px",url:"/upload/UploadAction",multiple:!0,dragDrop:!0,del:!0,finishDel:!1,onSelect:function(t,e){},onDelete:function(t,e){},onSuccess:function(t){},onFailure:function(t){},onComplete:function(t){}};i=t.extend(a,e),this.init=function(){this.createHtml(),this.createCorePlug()},this.createHtml=function(){var e="";e=i.multiple?"multiple":"";var a="";if(i.dragDrop)a+='	<div class="upload_box">',a+='		<div class="upload_main">',a+='			<div class="upload_choose">',a+='				<div class="convent_choice">',a+='					<div class="andArea">',a+='						<div class="filePicker">点击选择文件</div>',a+='						<input id="fileImage" type="file" size="30" name="fileselect[]" '+e+">",a+="					</div>",a+="				</div>",a+='				<span id="fileDragArea" class="upload_drag_area">或者将文件拖到此处</span>',a+="			</div>",a+='			<div class="status_bar">',a+='				<div id="status_info" class="info">选中0张文件，共0B。</div>',a+='				<div class="btns">',a+='					<div class="webuploader_pick">继续选择</div>',a+='					<div class="upload_btn" style="display:none">开始上传</div>',a+="				</div>",a+="			</div>",a+='			<div id="preview" class="upload_preview"></div>',a+="		</div>",a+='		<div class="upload_submit">',a+='			<button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>',a+="		</div>",a+='		<div id="uploadInf" class="upload_inf"></div>',a+="	</div>";else{var r=parseInt(i.itemWidth.replace("px",""))-15;a+='	<div class="upload_box">',a+='		<div class="upload_main single_main">',a+='			<div class="status_bar">',a+='				<div id="status_info" class="info">选中0张文件，共0B。</div>',a+='				<div class="btns">',a+='					<input id="fileImage" type="file" size="30" name="fileselect[]" '+e+">",a+='					<div class="webuploader_pick">选择文件</div>',a+='					<div class="upload_btn">开始上传</div>',a+="				</div>",a+="			</div>",a+='			<div id="preview" class="upload_preview">',a+='				<div class="add_upload">',a+='					<a style="height:'+i.itemHeight+";width:"+i.itemWidth+';" title="点击添加文件" id="rapidAddImg" class="add_imgBox" href="javascript:void(0)">',a+='						<div class="uploadImg" style="width:'+r+'px">',a+='							<img class="upload_image" src="control/images/add_img.png" style="width:expression(this.width > '+r+" ? "+r+'px : this.width)" />',a+="						</div>",a+="					</a>",a+="				</div>",a+="			</div>",a+="		</div>",a+='		<div class="upload_submit">',a+='			<button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>',a+="		</div>",a+='		<div id="uploadInf" class="upload_inf"></div>',a+="	</div>"}t(n).append(a).css({width:i.width,height:i.height}),this.addEvent()},this.funSetStatusInfo=function(e){var i=0,n=e.length;t.each(e,function(t,e){i+=e.size}),i=i>1048576?(Math.round(100*i/1048576)/100).toString()+"MB":(Math.round(100*i/1024)/100).toString()+"KB",t("#status_info").html("选中"+n+"张文件，共"+i+"。")},this.funFilterEligibleFile=function(t){for(var n,e=[],i=0;n=t[i];i++)n.size>=512e5?alert('您这个"'+n.name+'"文件大小过大'):e.push(n);return e},this.funDisposePreviewHtml=function(t,e){var n="",a=parseInt(i.itemWidth.replace("px",""))-15,r="";i.del&&(r='<span class="file_del" data-index="'+t.index+'" title="删除">X</span>');var o="control/images/fileType/";return o+=t.type.indexOf("rar")>0?"rar.png":t.type.indexOf("zip")>0?"zip.png":t.type.indexOf("text")>0?"txt.png":"file.png",0==t.type.indexOf("image")?(n+='<div id="uploadList_'+t.index+'" class="upload_append_list">',n+='	<div class="file_bar">',n+='		<div style="padding:5px;">',n+='			<p class="file_name">'+t.name+"</p>",n+=r,n+="		</div>",n+="	</div>",n+='	<a style="height:'+i.itemHeight+";width:"+i.itemWidth+';" href="#" class="imgBox">',n+='		<div class="uploadImg" style="width:'+a+'px">',n+='			<img id="uploadImage_'+t.index+'" class="upload_image" src="'+e.target.result+'" style="width:expression(this.width > '+a+" ? "+a+'px : this.width)" />',n+="		</div>",n+="	</a>",n+='	<p id="uploadProgress_'+t.index+'" class="file_progress"></p>',n+='	<p id="uploadFailure_'+t.index+'" class="file_failure">上传失败，请重试</p>',n+='	<p id="uploadSuccess_'+t.index+'" class="file_success"></p>',n+="</div>"):(n+='<div id="uploadList_'+t.index+'" class="upload_append_list">',n+='	<div class="file_bar">',n+='		<div style="padding:5px;">',n+='			<p class="file_name">'+t.name+"</p>",n+=r,n+="		</div>",n+="	</div>",n+='	<a style="height:'+i.itemHeight+";width:"+i.itemWidth+';" href="#" class="imgBox">',n+='		<div class="uploadImg" style="width:'+a+'px">',n+='			<img id="uploadImage_'+t.index+'" class="upload_image" src="'+o+'" style="width:expression(this.width > '+a+" ? "+a+'px : this.width)" />',n+="		</div>",n+="	</a>",n+='	<p id="uploadProgress_'+t.index+'" class="file_progress"></p>',n+='	<p id="uploadFailure_'+t.index+'" class="file_failure">上传失败，请重试</p>',n+='	<p id="uploadSuccess_'+t.index+'" class="file_success"></p>',n+="</div>"),n},this.createCorePlug=function(){var e={fileInput:t("#fileImage").get(0),uploadInput:t("#fileSubmit").get(0),dragDrop:t("#fileDragArea").get(0),url:t("#uploadForm").attr("action"),filterFile:function(t){return n.funFilterEligibleFile(t)},onSelect:function(e,a){i.onSelect(e,a),n.funSetStatusInfo(ZYFILE.funReturnNeedFiles());var r="",o=0,s=function(){if(file=e[o],file){var t=new FileReader;t.onload=function(t){r+=n.funDisposePreviewHtml(file,t),o++,s()},t.readAsDataURL(file)}else l(r)},l=function(e){i.dragDrop?t("#preview").append(e):t(".add_upload").before(e),d(),h()},d=function(){t(".file_del").length>0&&t(".file_del").click(function(){return ZYFILE.funDeleteFile(parseInt(t(this).attr("data-index")),!0),!1}),t(".file_edit").length>0&&t(".file_edit").click(function(){return!1})},h=function(){t(".upload_append_list").hover(function(e){t(this).find(".file_bar").addClass("file_hover")},function(e){t(this).find(".file_bar").removeClass("file_hover")})};s()},onDelete:function(e,i){t("#uploadList_"+e.index).fadeOut(),n.funSetStatusInfo(i),console.info("剩下的文件"),console.info(i)},onProgress:function(e,i,n){var a=t("#uploadProgress_"+e.index),r=(i/n*100).toFixed(2)+"%";a.is(":hidden")&&a.show(),a.css("width",r)},onSuccess:function(e,a){t("#uploadProgress_"+e.index).hide(),t("#uploadSuccess_"+e.index).show(),t("#uploadInf").append("<p>上传成功！</p>"),i.finishDel&&(t("#uploadList_"+e.index).fadeOut(),n.funSetStatusInfo(ZYFILE.funReturnNeedFiles()))},onFailure:function(e){t("#uploadProgress_"+e.index).hide(),t("#uploadSuccess_"+e.index).show(),t("#uploadInf").append("<p>文件"+e.name+"上传失败！</p>")},onComplete:function(t){console.info(t)},onDragOver:function(){t(this).addClass("upload_drag_hover")},onDragLeave:function(){t(this).removeClass("upload_drag_hover")}};ZYFILE=t.extend(ZYFILE,e),ZYFILE.init()},this.addEvent=function(){t(".filePicker").length>0&&t(".filePicker").bind("click",function(e){t("#fileImage").click()}),t(".webuploader_pick").bind("click",function(e){t("#fileImage").click()}),t(".upload_btn").bind("click",function(e){ZYFILE.funReturnNeedFiles().length>0?t("#fileSubmit").click():alert("请先选中文件再点击上传")}),t("#rapidAddImg").length>0&&t("#rapidAddImg").bind("click",function(e){t("#fileImage").click()})},this.init()})}}(jQuery);